(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4095],{86123:function(e,t,n){Promise.resolve().then(n.bind(n,50296))},50296:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return R}});var s=n(57437);n(21998);var r=n(2265),i=n(9273),o=n(96513),a=n(42333),u=n(43194),c=n(98024),f=n(24670),l=n(22977),d=n(35029),h=n(88965),_=n(86998),p=n(71736),m=n(84717),g=n(61196),v=n(5816),w=function(){function e(t,n,s,r,i,o,a,u){var c=this;(0,l._)(this,e),this.stopped=!1,this.countReconnect=0,this.ws=null,this.stopped=!1,this.countReconnect=0,this.info=t,this.reloadInfo=n,this.setHasNewAnnouncement=r,this.setNeedReloadAnnouncement=s,this.setHasNewMessage=i,this.setNeedReloadArea=o,this.updateCurrentAp=a,this.swrMutate=u,setTimeout(function(){c.connect()},2e3)}var t=e.prototype;return t.handleMessage=function(t){var n=this,r={key:"notification-".concat(+new Date),className:"push-notification",duration:null};switch(t.type){case"tick_update":setTimeout(function(){e.notification.info((0,h._)((0,d._)({},r),{icon:(0,s.jsx)(_.Z,{}),message:"赛程提醒",description:t.new_tick_name.replace(/;/,"，")})),n.reloadInfo()},200+1300*Math.random());break;case"new_announcement":e.notification.info((0,h._)((0,d._)({},r),{icon:(0,s.jsx)(m.Z,{}),message:"比赛公告",description:"有新的公告【".concat(t.title,"】")})),this.setNeedReloadAnnouncement(!0);break;case"game_message":e.notification.info((0,h._)((0,d._)({},r),{icon:(0,s.jsx)(p.Z,{}),message:t.title,description:t.message}));break;case"update_announcements":this.setNeedReloadAnnouncement(!0);break;case"staff_action":switch(t.action){case"modify_ap":this.updateCurrentAp();break;case"modify_spap":this.reloadInfo()}e.notification.info((0,h._)((0,d._)({},r),{icon:(0,s.jsx)(g.Z,{}),message:"队伍动态",description:t.message}));break;case"teammate_action":switch(e.notification.success((0,h._)((0,d._)({},r),{icon:(0,s.jsx)(g.Z,{}),message:"队友动态提醒",description:t.message})),t.action){case"buy_normal_hint":this.swrMutate({endpoint:"puzzle/get_hints",payload:{puzzle_key:t.puzzle_key}}).then(),this.updateCurrentAp();break;case"submission":this.setNeedReloadArea(!0),this.swrMutate({endpoint:"puzzle/get_detail",payload:{puzzle_key:t.puzzle_key}}).then(),this.swrMutate({endpoint:"puzzle/get_submissions",payload:{puzzle_key:t.puzzle_key}}).then()}break;case"game_start":this.reloadInfo(),e.notification.success((0,h._)((0,d._)({},r),{icon:(0,s.jsx)(g.Z,{}),message:"游戏状态更新",description:"你的队伍开始了游戏！"}));break;case"new_message":if("success"!==this.info.status||!this.info.user)break;"to_staff"===t.direction&&"staff"===this.info.user.group?e.notification.success((0,h._)((0,d._)({},r),{icon:(0,s.jsx)(g.Z,{}),message:"新消息提醒",description:"队伍 [".concat(t.team_name,"] 发送了一条站内信。")})):"to_staff"===t.direction&&"player"===this.info.user.group&&t.sender_id!==this.info.user.id?e.notification.success((0,h._)((0,d._)({},r),{icon:(0,s.jsx)(g.Z,{}),message:"新消息提醒",description:"你的队友发送了一条站内信。"})):"to_user"===t.direction&&"player"===this.info.user.group&&e.notification.success((0,h._)((0,d._)({},r),{icon:(0,s.jsx)(g.Z,{}),message:"新消息提醒",description:"工作人员回复了一条站内信。"})),this.setHasNewMessage(!0)}},t.connect=function(){var t=this;if(!this.stopped){var n=new URL(v.fL+"push?tabid="+window.tid+"&preid="+window.pid,window.location.href);n.protocol="http:"===n.protocol?"ws:":"wss:",this.ws=new WebSocket(n.href);var s=null;this.ws.onopen=function(){s=setTimeout(function(){t.countReconnect=0},25e3)},this.ws.onclose=function(n){if(4337===n.code){t.stopped=!0;return}setTimeout(function(){t.countReconnect<8?(t.countReconnect++,t.connect()):e.message.error({content:"消息推送连接中断",key:"PushDaemon.Error",duration:3}).then()},5e3),null!=s&&clearTimeout(s)},this.ws.onmessage=function(e){t.handleMessage(JSON.parse(e.data))}}},t.stop=function(){this.stopped=!0,null!==this.ws&&this.ws.close()},e.init=function(t,n){e.notification=t,e.message=n},e}(),z=n(54477),x=n(7775),k=n(33116),j=n(48749),N=n(80603);function y(e){var t=e.info,n=e.reloadInfo,i=(0,r.useContext)(x.s),o=i.setNeedReloadAnnouncement,u=i.setHasNewAnnouncement,c=i.setHasNewMessage,l=i.setNeedReloadArea,d=i.updateCurrentAp,h=(0,f._)(j.ZP.useNotification({stack:{threshold:3},placement:"topRight",top:70}),2),_=h[0],p=h[1],m=(0,f._)(k.ZP.useMessage(),1)[0],g=(0,a.kY)().mutate;if("success"!==t.status)throw new z.sF;return(0,r.useEffect)(function(){j.ZP.config({closeIcon:(0,s.jsx)(N.Z,{})}),w.init(_,m)},[m,_]),(0,r.useEffect)(function(){if(null!==t&&t.feature.push){var e=new w(t,n,o,u,c,l,d,g);return function(){e.stop()}}},[t,g,n,u,c,o,l,d,_]),(0,s.jsx)(s.Fragment,{children:p})}function b(e){var t=e.children,n=(0,r.useContext)(u._s),i=n.info,o=n.reloadInfo;if("success"!==i.status)throw new z._e;return(0,s.jsxs)(s.Fragment,{children:[i.feature.push?(0,s.jsx)(y,{info:i,reloadInfo:o}):null,t]})}var S=n(84987);function P(e){var t=e.children,n=(0,r.useContext)(u._s),i=n.info,o=n.reloadInfo;return"error"===i.status?(0,s.jsx)(c.d,{res:i,reload:o}):(0,s.jsx)(s.Fragment,{children:t})}function R(e){var t=e.children;return(0,s.jsx)(i.default,{locale:o.Z,theme:{token:{},components:{Menu:{motionDurationMid:"0.1",motionDurationSlow:"0.1"}}},children:(0,s.jsx)(a.J$,{value:{refreshInterval:6e5,keepPreviousData:!0,dedupingInterval:5e3,errorRetryCount:3},children:(0,s.jsx)(u.t3,{children:(0,s.jsx)(S.N,{children:(0,s.jsx)(x.E,{children:(0,s.jsx)(b,{children:(0,s.jsx)(P,{children:t})})})})})})})}},47915:function(e,t,n){"use strict";n.d(t,{a:function(){return u}});var s=n(57437),r=n(88110),i=n.n(r),o=n(22762),a=n(24033);function u(e){var t,n=e.title,r=e.subtitle,u=e.reload;return(0,a.useRouter)(),t=u?[(0,s.jsx)(i(),{type:"primary",onClick:u,children:"重试"},"reload"),(0,s.jsx)(i(),{onClick:function(){return window.location.href="/home"},children:"回到首页"},"home")]:[(0,s.jsx)(i(),{onClick:function(){return window.location.href="/home"},children:"回到首页"},"home")],(0,s.jsx)(o.ZP,{status:"error",title:n,subTitle:r,extra:t,style:{backgroundColor:"#fafafa",borderRadius:"16px"}})}n(2265)},35239:function(e,t,n){"use strict";n.d(t,{g:function(){return i}});var s=n(57437),r=n(26782);function i(){return(0,s.jsx)("div",{children:(0,s.jsx)(r.default,{active:!0,paragraph:!0})})}},98024:function(e,t,n){"use strict";n.d(t,{d:function(){return i}});var s=n(57437),r=n(47915);function i(e){var t=e.res,n=e.reload;return n?(0,s.jsx)(r.a,{title:"错误：".concat(t.message),subtitle:(0,s.jsxs)(s.Fragment,{children:["如果你确信这是异常情况，请先尝试重试，如果仍出现问题，请及时联系网站管理员。",(0,s.jsx)("br",{})]}),reload:n}):(0,s.jsx)(r.a,{title:"错误：".concat(t.message),subtitle:(0,s.jsx)(s.Fragment,{children:"如果你确信这是异常情况，请及时联系网站管理员。"})})}},54477:function(e,t,n){"use strict";n.d(t,{$v:function(){return c},Dc:function(){return f},_e:function(){return u},sF:function(){return a}});var s=n(22977),r=n(6408),i=n(56417),o=n(93891),a=function(e){(0,r._)(n,e);var t=(0,o._)(n);function n(e){var r;return(0,s._)(this,n),(r=t.call(this,e||"")).name="NeverError",r}return n}((0,i._)(Error)),u=function(e){(0,r._)(n,e);var t=(0,o._)(n);function n(e){var r;return(0,s._)(this,n),(r=t.call(this,e||"")).name="InfoError",r}return n}((0,i._)(Error)),c=function(e){(0,r._)(n,e);var t=(0,o._)(n);function n(e){var r;return(0,s._)(this,n),(r=t.call(this,e||"")).name="NotStaffError",r}return n}((0,i._)(Error)),f=function(e){(0,r._)(n,e);var t=(0,o._)(n);function n(e,r){var i;return(0,s._)(this,n),(i=t.call(this,e||"")).name="DataError",i.title=r,i}return n}((0,i._)(Error))},43194:function(e,t,n){"use strict";n.d(t,{$3:function(){return f},_s:function(){return u},ei:function(){return l},t3:function(){return c}});var s=n(57437),r=n(2265),i=n(59666),o=n(35239),a=n(54477),u=(0,r.createContext)(void 0);function c(e){var t=e.children,n=(0,i.L)({endpoint:"game/game_info"}),r=n.data,a=n.mutate;return r?(0,s.jsx)(u.Provider,{value:{info:r,reloadInfo:a},children:t}):(0,s.jsx)(o.g,{})}function f(){return(0,r.useContext)(u).info}function l(){var e=f();if("success"!==e.status)throw new a._e;return e}},84987:function(e,t,n){"use strict";n.d(t,{N:function(){return c},Q:function(){return u}});var s=n(24670),r=n(57437),i=n(2265),o=n(43194),a=n(38225),u=(0,i.createContext)(void 0);function c(e){var t,n=e.children,c=(0,o.ei)(),f=(0,s._)((0,i.useState)(!1),2),l=f[0],d=f[1],h=(0,s._)((0,i.useState)(!1),2),_=h[0],p=h[1],m=function(e){localStorage.setItem(e,(0,a.gz)({useLinkForPuzzle:!1,usePuzzleList:!1}))},g=null===(t=c.user)||void 0===t?void 0:t.id,v=g?g+"_setting":"default_setting";return(0,i.useEffect)(function(){var e=localStorage.getItem(v);if(!e){m(v);return}var t=(0,a.vT)(e);if(!t){m(v);return}d(!!t.useLinkForPuzzle),p(!!t.usePuzzleList)},[v]),(0,r.jsx)(u.Provider,{value:{useLinkForPuzzle:l,setUseLinkForPuzzle:function(e){localStorage.setItem(v,(0,a.gz)({useLinkForPuzzle:e,usePuzzleList:_})),d(e),localStorage.getItem(v)},usePuzzleList:_,setUsePuzzleList:function(e){localStorage.setItem(v,(0,a.gz)({useLinkForPuzzle:l,usePuzzleList:e})),p(e),localStorage.getItem(v)}},children:n})}},7775:function(e,t,n){"use strict";n.d(t,{E:function(){return f},s:function(){return c}});var s=n(24670),r=n(57437),i=n(2265),o=n(67912),a=n(38225),u=n(43194),c=(0,i.createContext)(void 0);function f(e){var t=e.children,n=(0,s._)((0,i.useState)(!1),2),f=n[0],l=n[1],d=(0,s._)((0,i.useState)(!1),2),h=d[0],_=d[1],p=(0,s._)((0,i.useState)(!1),2),m=p[0],g=p[1],v=(0,s._)((0,i.useState)(!1),2),w=v[0],z=v[1],x=(0,s._)((0,i.useState)(!1),2),k=x[0],j=x[1],N=(0,s._)((0,i.useState)(!1),2),y=N[0],b=N[1],S=(0,s._)((0,i.useState)(!1),2),P=S[0],R=S[1],C=(0,s._)((0,i.useState)(0),2),I=C[0],A=C[1],E=(0,s._)((0,i.useState)(0),2),Z=E[0],L=E[1],M=(0,s._)((0,i.useState)(0),2),F=M[0],H=M[1],D=(0,s._)((0,i.useState)([[0,0]]),2),T=D[0],O=D[1],J=(0,u.ei)(),U=(0,i.useCallback)(function(){(0,o.HC)({endpoint:"game/team_ap_detail"}).then(function(e){if("error"!==e.status){var t=e.data.team_ap_change,n=e.data.ap_increase_policy;JSON.stringify(n)!==JSON.stringify(T)&&O(n),H(t),A((0,a.Rp)(n,t)),L((0,a.Jy)(n))}})},[T]),$=(0,i.useCallback)(function(){T&&A((0,a.Rp)(T,F))},[F,T]),Q=(0,i.useRef)(U);return(0,i.useEffect)(function(){J.user&&J.team&&"staff"!==J.user.group&&Q.current()},[J,Q]),(0,i.useEffect)(function(){if(J.user&&J.team&&"staff"!==J.user.group){var e=setInterval($,2e4);return function(){clearInterval(e)}}},[J,$]),(0,r.jsx)(c.Provider,{value:{needReloadAnnouncement:f,setNeedReloadAnnouncement:l,hasNewAnnouncement:w,setHasNewAnnouncement:z,staffUnreadOnly:k,setStaffUnreadOnly:j,staffTimeDesc:y,setStaffTimeDesc:b,hasNewMessage:P,setHasNewMessage:R,needReloadPuzzle:h,setNeedReloadPuzzle:_,needReloadArea:m,setNeedReloadArea:g,currentAp:I,currentApIncrease:Z,updateCurrentAp:U},children:t})}},59666:function(e,t,n){"use strict";n.d(t,{F:function(){return o},L:function(){return i}});var s=n(42333),r=n(67912);function i(e){var t=(0,s.ZP)(e,function(e){return(0,r.HC)(e)},{refreshInterval:18e5});return{data:t.data,mutate:t.mutate}}function o(e){var t=(0,s.ZP)(e,function(e){return(0,r.HC)(e)});return{data:t.data,mutate:t.mutate}}},21998:function(){}},function(e){e.O(0,[5583,4410,6857,6126,6559,8110,8051,3116,5708,2359,2169,2971,7864,1744],function(){return e(e.s=86123)}),_N_E=e.O()}]);