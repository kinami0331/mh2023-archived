var Imported=Imported||{};Imported.FlyCat_eventLabel=true;var FlyCat=FlyCat||{};FlyCat.eventLabel={};FlyCat.eventLabel.parameters=PluginManager.parameters("FlyCat_eventLabel");FlyCat.eventLabel.fontSize=Number(FlyCat.eventLabel.parameters["字体大小"]||14);FlyCat.eventLabel.actorTitle=Number(FlyCat.eventLabel.parameters["称号装备槽ID"]||5);PluginManager.registerCommand("FlyCat_eventLabel","ShowActorTitle",(args=>{$gameTemp.eventLabel(eval(args.button))}));Game_Temp.prototype.eventLabel=function(button){this._eventLabel=button};Sprite_Character.prototype.setCharacter=function(character){this._character=character;this.createNameSprite(character)};FlyCat.eventLabel.Sprite_Character_setCharacterBitmap=Sprite_Character.prototype.setCharacterBitmap;Sprite_Character.prototype.setCharacterBitmap=function(){FlyCat.eventLabel.Sprite_Character_setCharacterBitmap.call(this);this._charBitmap=ImageManager.loadCharacter(this._characterName);this._charBitmap.addLoadListener(this.updateCharBitmap.bind(this))};Sprite_Character.prototype.updateCharBitmap=function(){if(this._titleSprite){this._titleSprite.y=-this.patternHeight();this._titleSprite.alpha=1}if(this._nameSprite){this._nameSprite.y=-this.patternHeight()}};FlyCat.eventLabel.Sprite_Character_update=Sprite_Character.prototype.update;Sprite_Character.prototype.update=function(){FlyCat.eventLabel.Sprite_Character_update.call(this);if($gameTemp._eventLabel&&this._titleSprite){this._titleSprite.visible=false}else if(!$gameTemp._eventLabel&&this._titleSprite){this._titleSprite.visible=true}};Sprite_Character.prototype.createNameSprite=function(character){if(character instanceof Game_Event){const event=$dataMap.events[character._eventId];if(event.meta.name){const params=event.meta.name.split(",");this.createSprite(params)}}else if(character instanceof Game_Player){const player=$gameParty.members()[0];this.TitleSpritedestroy();this.createTitleSprite(player)}else if(character instanceof Game_Follower){if(character){const follower=character.actor();this.TitleSpritedestroy();this.createTitleSprite(follower)}}};Sprite_Character.prototype.createTitleSprite=function(player){if(player){const actorTitle=player.equips()[FlyCat.eventLabel.actorTitle];if(actorTitle){if(actorTitle.meta.titleImg){const titleImgName=String(actorTitle.meta.titleImg);const newBitmap=ImageManager.loadBitmap("img/actorTitle/",titleImgName);this._titleSprite=new Sprite(newBitmap);this._titleSprite.alpha=0;this._titleSprite.x=0;this._titleSprite.anchor.x=.5;this._titleSprite.anchor.y=1;this.addChild(this._titleSprite)}}}};Sprite_Character.prototype.TitleSpritedestroy=function(){if(this._titleSprite){this.removeChild(this._titleSprite);this._titleSprite.destroy();this._titleSprite=null}};Sprite_Character.prototype.createSprite=function(params){if(this._nameSprite){this.removeChild(this._nameSprite);this._nameSprite.destroy();this._nameSprite=null}const name=String(params[0]);let colorId=params[1]||0;colorId=Number(colorId).clamp(0,32);const win=new Window_Base(new Rectangle(0,0,1,1));win.contents.fontSize=FlyCat.eventLabel.fontSize;const width=win.textWidth(name)+10;const height=win.lineHeight();const bitmap=new Bitmap(width,height);bitmap.fontSize=FlyCat.eventLabel.fontSize;bitmap.textColor=ColorManager.textColor(colorId);bitmap.drawText(name,0,0,width,height,"center");this._nameSprite=new Sprite(bitmap);this._nameSprite.anchor.x=.5;this._nameSprite.anchor.y=1;this._nameSprite.x=0;this.addChild(this._nameSprite)};