var Imported=Imported||{};Imported.YEP_SelfSwVar=true;var Yanfly=Yanfly||{};Yanfly.SSV=Yanfly.SSV||{};DataManager.isSelfSwitch=function(switchId){var sw=$dataSystem.switches[switchId];return sw&&sw.match(/SELF[ ]SW/i)};DataManager.isSelfVariable=function(variableId){var va=$dataSystem.variables[variableId];return va&&va.match(/SELF[ ]VAR/i)};Game_Temp.prototype.getSelfSwVarEvent=function(){return this._selfSwVarEvent};Game_Temp.prototype.setSelfSwVarEvent=function(mapId,eventId){this._selfSwVarEvent=[mapId,eventId]};Game_Temp.prototype.clearSelfSwVarEvent=function(){this._selfSwVarEvent=undefined};Game_Temp.prototype.getSelfSwVarEvBrdge=function(){return this._selfSwVarEvBridge};Game_Temp.prototype.setSelfSwVarEvBridge=function(mapId,eventId){this.setSelfSwVarEvent(mapId,eventId);this._selfSwVarEvBridge=[mapId,eventId]};Game_Temp.prototype.clearSelfSwVarEvBridge=function(){this._selfSwVarEvent=this._selfSwVarEvBridge;this._selfSwVarEvBridge=undefined};Game_Temp.prototype.getSelfSwVarEventOneTimeClear=function(){return this._selfSwVarEventOneTimeClear};Game_Temp.prototype.setSelfSwVarEventOneTimeClear=function(value){this._selfSwVarEventOneTimeClear=value};Game_Temp.prototype.getPersistingSelfSwVarEvent=function(){return this._selfPersistingSwVarEvent};Game_Temp.prototype.setPersistingSelfSwVarEvent=function(mapId,eventId){this._selfPersistingSwVarEvent=[mapId,eventId]};Game_Temp.prototype.carryPersistingSelfSwVarEvent=function(){this._revertSelfSwVarEvent=this._selfSwVarEvent;this._selfSwVarEvent=[];if(!this._selfPersistingSwVarEvent)return;this._selfSwVarEvent.push(this._selfPersistingSwVarEvent[0]);this._selfSwVarEvent.push(this._selfPersistingSwVarEvent[1])};Game_Temp.prototype.revertSelfSwVarEvent=function(){this._selfSwVarEvent=this._revertSelfSwVarEvent};Yanfly.SSV.Game_Character_processMoveCommand=Game_Character.prototype.processMoveCommand;Game_Character.prototype.processMoveCommand=function(command){if(this._mapId&&this._eventId){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId)}Yanfly.SSV.Game_Character_processMoveCommand.call(this,command);if(this._mapId&&this._eventId){$gameTemp.clearSelfSwVarEvent()}};Yanfly.SSV.Game_Event_meetsConditions=Game_Event.prototype.meetsConditions;Game_Event.prototype.meetsConditions=function(page){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);var value=Yanfly.SSV.Game_Event_meetsConditions.call(this,page);$gameTemp.clearSelfSwVarEvent();return value};Yanfly.SSV.Game_Switches_value=Game_Switches.prototype.value;Game_Switches.prototype.value=function(switchId){if(DataManager.isSelfSwitch(switchId)&&$gameTemp.getSelfSwVarEvent()){var mapId=$gameTemp.getSelfSwVarEvent()[0];var eventId=$gameTemp.getSelfSwVarEvent()[1];var switchId="SELF SWITCH "+switchId;var key=[mapId,eventId,switchId];return $gameSelfSwitches.value(key)}else{return Yanfly.SSV.Game_Switches_value.call(this,switchId)}};Yanfly.SSV.Game_Switches_setValue=Game_Switches.prototype.setValue;Game_Switches.prototype.setValue=function(switchId,value){if(switchId<=0)return;if(DataManager.isSelfSwitch(switchId)&&$gameTemp.getSelfSwVarEvent()){var mapId=$gameTemp.getSelfSwVarEvent()[0];var eventId=$gameTemp.getSelfSwVarEvent()[1];var switchId="SELF SWITCH "+switchId;var key=[mapId,eventId,switchId];$gameSelfSwitches.setValue(key,value)}else{Yanfly.SSV.Game_Switches_setValue.call(this,switchId,value)}};Yanfly.SSV.Game_Variables_value=Game_Variables.prototype.value;Game_Variables.prototype.value=function(variableId){if(DataManager.isSelfVariable(variableId)&&$gameTemp.getSelfSwVarEvent()){var mapId=$gameTemp.getSelfSwVarEvent()[0];var eventId=$gameTemp.getSelfSwVarEvent()[1];var variableId="SELF VARIABLE "+variableId;var key=[mapId,eventId,variableId];return $gameSelfSwitches.value(key)}else{return Yanfly.SSV.Game_Variables_value.call(this,variableId)}};Yanfly.SSV.Game_Variables_setValue=Game_Variables.prototype.setValue;Game_Variables.prototype.setValue=function(variableId,value){if(variableId<=0)return;if(DataManager.isSelfVariable(variableId)&&$gameTemp.getSelfSwVarEvent()){var mapId=$gameTemp.getSelfSwVarEvent()[0];var eventId=$gameTemp.getSelfSwVarEvent()[1];var variableId="SELF VARIABLE "+variableId;var key=[mapId,eventId,variableId];$gameSelfSwitches.setValue(key,value)}else{Yanfly.SSV.Game_Variables_setValue.call(this,variableId,value)}};Yanfly.SSV.Game_SelfSwitches_value=Game_SelfSwitches.prototype.value;Game_SelfSwitches.prototype.value=function(key){if(key[2].match(/SELF[ ]VAR/i)){this._data[key]=this._data[key]||0;return this._data[key]}return Yanfly.SSV.Game_SelfSwitches_value.call(this,key)};Yanfly.SSV.Game_SelfSwitches_setValue=Game_SelfSwitches.prototype.setValue;Game_SelfSwitches.prototype.setValue=function(key,value){if(key[2].match(/SELF[ ]VAR/i)){this._data[key]=value;this.onChange()}else{Yanfly.SSV.Game_SelfSwitches_setValue.call(this,key,value)}};Yanfly.SSV.Game_SelfSwitches_onChange=Game_SelfSwitches.prototype.onChange;Game_SelfSwitches.prototype.onChange=function(){Yanfly.SSV.Game_SelfSwitches_onChange.call(this);if($gameTemp.getSelfSwVarEventOneTimeClear()){$gameTemp.setSelfSwVarEventOneTimeClear(false);$gameTemp.clearSelfSwVarEvent()}};Yanfly.SSV.Game_Interpreter_command101=Game_Interpreter.prototype.command101;Game_Interpreter.prototype.command101=function(){$gameTemp.setPersistingSelfSwVarEvent(this._mapId,this._eventId);return Yanfly.SSV.Game_Interpreter_command101.call(this)};Yanfly.SSV.Game_Interpreter_command104=Game_Interpreter.prototype.command104;Game_Interpreter.prototype.command104=function(){$gameTemp.setSelfSwVarEventOneTimeClear(true);$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);return Yanfly.SSV.Game_Interpreter_command104.call(this)};Yanfly.SSV.Game_Interpreter_command111=Game_Interpreter.prototype.command111;Game_Interpreter.prototype.command111=function(){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_command111.call(this);$gameTemp.clearSelfSwVarEvent();return true};Yanfly.SSV.Game_Interpreter_command121=Game_Interpreter.prototype.command121;Game_Interpreter.prototype.command121=function(){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_command121.call(this);$gameTemp.clearSelfSwVarEvent();return true};Yanfly.SSV.Game_Interpreter_command122=Game_Interpreter.prototype.command122;Game_Interpreter.prototype.command122=function(){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_command122.call(this);$gameTemp.clearSelfSwVarEvent();return true};Yanfly.SSV.Game_Interpreter_command201=Game_Interpreter.prototype.command201;Game_Interpreter.prototype.command201=function(){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_command201.call(this);$gameTemp.clearSelfSwVarEvent();return false};Yanfly.SSV.Game_Interpreter_command202=Game_Interpreter.prototype.command202;Game_Interpreter.prototype.command202=function(){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_command202.call(this);$gameTemp.clearSelfSwVarEvent();return true};Yanfly.SSV.Game_Interpreter_command203=Game_Interpreter.prototype.command203;Game_Interpreter.prototype.command203=function(){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_command203.call(this);$gameTemp.clearSelfSwVarEvent();return true};Yanfly.SSV.Game_Interpreter_command231=Game_Interpreter.prototype.command231;Game_Interpreter.prototype.command231=function(){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_command231.call(this);$gameTemp.clearSelfSwVarEvent();return true};Yanfly.SSV.Game_Interpreter_command232=Game_Interpreter.prototype.command232;Game_Interpreter.prototype.command232=function(){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_command232.call(this);$gameTemp.clearSelfSwVarEvent();return true};Yanfly.SSV.Game_Interpreter_command285=Game_Interpreter.prototype.command285;Game_Interpreter.prototype.command285=function(){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_command285.call(this);$gameTemp.clearSelfSwVarEvent();return true};Yanfly.SSV.Game_Interpreter_operateValue=Game_Interpreter.prototype.operateValue;Game_Interpreter.prototype.operateValue=function(op1,type,op2){$gameTemp.setSelfSwVarEvent(this._mapId,this._eventId);value=Yanfly.SSV.Game_Interpreter_operateValue.call(this,op1,type,op2);$gameTemp.clearSelfSwVarEvent();return value};Yanfly.SSV.Game_Interpreter_setupItemChoice=Game_Interpreter.prototype.setupItemChoice;Game_Interpreter.prototype.setupItemChoice=function(params){$gameTemp.setSelfSwVarEvBridge(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_setupItemChoice.call(this,params)};Yanfly.SSV.Game_Interpreter_setupNumInput=Game_Interpreter.prototype.setupNumInput;Game_Interpreter.prototype.setupNumInput=function(params){$gameTemp.setSelfSwVarEvBridge(this._mapId,this._eventId);Yanfly.SSV.Game_Interpreter_setupNumInput.call(this,params)};Yanfly.SSV.Game_Interpreter_pluginCommand=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(command,args){Yanfly.SSV.Game_Interpreter_pluginCommand.call(this,command,args);if(command==="MapSelectSkill"){$gameTemp.setSelfSwVarEventOneTimeClear(true);$gameTemp.setSelfSwVarEvBridge(this._mapId,this._eventId)}else if(command==="SelfSwitch"){var line=this.argsToString(args);this.adjustSelfSwitch(line)}else if(command==="SelfVariable"){var line=this.argsToString(args);this.adjustSelfVariable(line)}};Game_Interpreter.prototype.argsToString=function(args){var str="";var length=args.length;for(var i=0;i<length;++i){str+=args[i]+" "}return str.trim()};Game_Interpreter.prototype.adjustSelfSwitch=function(line){var eventId;var switchId;if(line.match(/(.*)[ ]TO[ ](.*)/i)){var data=String(RegExp.$1);var code=String(RegExp.$2).trim()}else{return}if(line.match(/EVENT[ ](\d+)/i))eventId=parseInt(RegExp.$1);if(eventId===undefined)return;if(line.match(/MAP[ ](\d+)/i))mapId=parseInt(RegExp.$1);if(mapId===undefined)return;if(line.match(/SWITCH[ ](\d+)/i))switchId=parseInt(RegExp.$1);if(switchId===undefined)return;if(!DataManager.isSelfSwitch(switchId))return;var key=[mapId,eventId,"SELF SWITCH "+switchId];var value=$gameSelfSwitches.value(key);value=eval(code);$gameSelfSwitches.setValue(key,value)};Game_Interpreter.prototype.adjustSelfVariable=function(line){var eventId;var varId;if(line.match(/(.*)[ ]TO[ ](.*)/i)){var data=String(RegExp.$1);var code=String(RegExp.$2).trim()}else{return}if(line.match(/EVENT[ ](\d+)/i))eventId=parseInt(RegExp.$1);if(eventId===undefined)return;if(line.match(/MAP[ ](\d+)/i))mapId=parseInt(RegExp.$1);if(mapId===undefined)return;if(line.match(/VARIABLE[ ](\d+)/i))varId=parseInt(RegExp.$1);if(varId===undefined)return;if(!DataManager.isSelfVariable(varId))return;var key=[mapId,eventId,"SELF VARIABLE "+varId];var value=$gameSelfSwitches.value(key);value=eval(code);$gameSelfSwitches.setValue(key,value)};Game_Interpreter.prototype.getSelfSwitchValue=function(mapId,eventId,id){var key=[mapId,eventId,"SELF SWITCH "+id];return $gameSelfSwitches.value(key)};Game_Interpreter.prototype.getSelfVariableValue=function(mapId,eventId,id){var key=[mapId,eventId,"SELF VARIABLE "+id];return $gameSelfSwitches.value(key)};Game_Interpreter.prototype.setSelfSwitchValue=function(m,e,id,value){var key=[m,e,"SELF SWITCH "+id];$gameSelfSwitches.setValue(key,value)};Game_Interpreter.prototype.setSelfVariableValue=function(m,e,id,value){var key=[m,e,"SELF VARIABLE "+id];$gameSelfSwitches.setValue(key,value)};Yanfly.SSV.Window_Message_startMessage=Window_Message.prototype.startMessage;Window_Message.prototype.startMessage=function(){$gameTemp.carryPersistingSelfSwVarEvent();Yanfly.SSV.Window_Message_startMessage.call(this);$gameTemp.revertSelfSwVarEvent()};Yanfly.SSV.Window_NumberInput_processOk=Window_NumberInput.prototype.processOk;Window_NumberInput.prototype.processOk=function(){$gameTemp.clearSelfSwVarEvBridge();Yanfly.SSV.Window_NumberInput_processOk.call(this);$gameTemp.clearSelfSwVarEvent()};Yanfly.SSV.Window_EventItem_onOk=Window_EventItem.prototype.onOk;Window_EventItem.prototype.onOk=function(){$gameTemp.clearSelfSwVarEvBridge();Yanfly.SSV.Window_EventItem_onOk.call(this);$gameTemp.clearSelfSwVarEvent()};